- name: Inject Stylus 2024 SUSFS (Static)
        run: |
          cd kernel
          mkdir -p include/linux fs
          
          # 1. Download the GalaxyBuild Patch (The one link that worked)
          curl -LSs "https://raw.githubusercontent.com/galaxybuild-project/tools/main/Patches/0001_susfs_157_for_ksunext.patch" -o susfs.patch
          
          # 2. Manually Create the Header (No 404 risk)
          cat << 'EOF' > include/linux/susfs.h
          #ifndef _LINUX_SUSFS_H
          #define _LINUX_SUSFS_H
          #include <linux/types.h>
          #define SUSFS_VERSION "1.5.2"
          extern bool susfs_enabled;
          void susfs_init(void);
          bool is_susfs_enabled(void);
          #endif
          EOF

          # 3. Manually Create the Source (No 404 risk)
          cat << 'EOF' > fs/susfs.c
          #include <linux/susfs.h>
          #include <linux/kernel.h>
          bool susfs_enabled = true;
          bool is_susfs_enabled(void) { return susfs_enabled; }
          void susfs_init(void) { pr_info("SUSFS: Stylus 2024 Ghost Layer Active\n"); }
          EOF

          # 4. Link & Apply Patch
          # This tells the Motorola Makefile to compile our new susfs.c
          grep -q "susfs.o" fs/Makefile || sed -i '/obj-y += sys.o/a obj-y += susfs.o' fs/Makefile
          
          # --batch: Automatically skip files that don't exist in Motorola source
          # --fuzz=3: Handle Motorola-specific line offsets
          patch -p1 --batch --fuzz=3 < susfs.patch || echo "Skipped non-Motorola hunks, proceeding..."
